{% extends "base.html" %}

{% block content %}
  <h4>Training Lists for <br></h4>
  <h3>"{{ text.title }}"</h3>
<a style="float: right;" href="{{ url_for('main.read_text', text_id=text.id) }}">üìñ Read & Add Phrases</a>
   <hr>

  <h4>Create New Training List</h4>
  <form method="POST">
    {{ form.hidden_tag() }}
  <div class="d-flex align-items-center mb-3" style="gap: 0.5rem;">
    <label for="{{ form.name.id }}" class="form-label mb-0">{{ form.name.label }}</label>
    {{ form.name(class="form-control", style="width: 300px;") }}
  </div>
    <!-- Line 2: Lang from –∏ Lang to -->
  <div class="d-flex gap-3 align-items-center flex-wrap mb-3">
    <div class="d-flex align-items-center" style="gap: 0.5rem;">
      <label for="{{ form.lang_from.id }}" class="form-label mb-0">{{ form.lang_from.label }}</label>
      {{ form.lang_from(class="form-select", style="min-width: 150px; max-width: 200px;") }}
    </div>

    <div class="d-flex align-items-center" style="gap: 0.5rem;">
      <label for="{{ form.lang_to.id }}" class="form-label mb-0">{{ form.lang_to.label }}</label>
      {{ form.lang_to(class="form-select", style="min-width: 150px; max-width: 200px;") }}
    </div>
  </div>

  <div>
    {{ form.submit(class="btn btn-primary") }}
  </div>

  </form>

  <hr>

  {% if lists %}
    <table id="training-table" class="table table-striped table-hover glo-hover-table table-sm align-middle">

      <thead class="table-light">
        <tr>
          <th class="sortable">List Name</th>
          <th class="sortable"># Items</th>
          <th class="sortable">Created</th>
          <th class="sortable" data-sort-default="desc">Last Used</th>
          <th class="sortable">Languages</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for lst in lists %}
          <tr>
            <td><strong>{{ lst.name }}</strong></td>
            <td>{{ lst.item_count }}</td>
            <td>{{ lst.created_at.strftime('%Y-%m-%d') }}</td>
            <td>{{ lst.last_used_at.strftime('%Y-%m-%d') }}</td>
            <td>{{ lst.lang_from }}-{{ lst.lang_to }}</td>
            <td>
              <a href="{{ url_for('main.train_list', list_id=lst.id) }}" class="btn btn-xs btn-outline-primary">‚ñ∂Ô∏è Train</a>
              <a href="{{ url_for('main.edit_training_list', list_id=lst.id) }}" class="btn btn-xs btn-outline-secondary">‚úèÔ∏è Edit</a>
              <a href="{{ url_for('main.add_training_item', list_id=lst.id) }}" class="btn btn-xs btn-outline-success">‚ûï Add</a>
              &nbsp;&nbsp;&nbsp;
<button
  class="btn btn-xs btn-outline-danger"
  data-bs-toggle="modal"
  data-bs-target="#confirmDeleteModal"
  data-list-id="{{ lst.id }}"
  data-list-name="{{ lst.name }}"
  data-item-count="{{ lst.item_count }}">
  üóëÔ∏è Delete
</button>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

  {% else %}
    <p>No training lists yet.</p>
  {% endif %}

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="POST" id="deleteListForm">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmDeleteModalLabel">Confirm Deletion</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="deleteMessage">Are you sure you want to delete this list?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Delete Confirmation Script -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  var modal = document.getElementById('confirmDeleteModal');
  modal.addEventListener('show.bs.modal', function (event) {
    var button = event.relatedTarget;
    var listId = button.getAttribute('data-list-id');
    var listName = button.getAttribute('data-list-name');
    var itemCount = parseInt(button.getAttribute('data-item-count'), 10);

    var message = "Are you sure you want to delete the list <br><strong>\"" + listName + "\"</strong> ?";
    if (itemCount === 0) {
      message += "<br>The list is currently empty.";
    } else {
      message += "<br>This will permanently delete all " + itemCount + " training item" + (itemCount === 1 ? "" : "s") + " associated with this list.";
    }

    document.getElementById('deleteMessage').innerHTML = message;

    var form = document.getElementById('deleteListForm');
    form.action = "/training-list/" + listId + "/delete";
  });
});
</script>

<!-- Table sort -->
<!--script>
  document.addEventListener("DOMContentLoaded", function () {
    new Tablesort(document.getElementById('training-table'));
  });
</script-->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const table = document.getElementById("training-table");
    const ths = table.querySelectorAll("th");

    const ts = new Tablesort(table);

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–π —Å—Ç—Ä–µ–ª–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫
    ths.forEach((th, index) => {
      th.addEventListener("click", () => {
        setTimeout(() => {
          ths.forEach(th2 => th2.classList.remove("sorted-asc", "sorted-desc"));

          const direction = th.getAttribute("aria-sort");
          if (direction === "ascending") {
            th.classList.add("sorted-asc");
          } else if (direction === "descending") {
            th.classList.add("sorted-desc");
          }
        }, 50);
      });
    });

    // ‚¨áÔ∏è –ó–∞–¥–∞–π –Ω–∞—á–∞–ª–Ω–æ —Å–æ—Ä—Ç–∏—Ä–∞–Ω–µ (–∞–∫–æ –∏–º–∞ data-sort-default)
    const defaultTh = table.querySelector('th[data-sort-default]');
    if (defaultTh) {
      const columnIndex = Array.from(ths).indexOf(defaultTh);
      const direction = defaultTh.getAttribute('data-sort-default');

      // –ö–ª–∏–∫–≤–∞–º–µ –≤–µ–¥–Ω—ä–∂ –∏–ª–∏ –¥–≤–∞ –ø—ä—Ç–∏, —Å–ø–æ—Ä–µ–¥ –ø–æ—Å–æ–∫–∞—Ç–∞
      defaultTh.click(); // –ø—ä—Ä–≤–æ —Å–æ—Ä—Ç–∏—Ä–∞–Ω–µ –≤—ä–∑—Ö–æ–¥—è—â–æ
      if (direction === 'asc') {
        setTimeout(() => defaultTh.click(), 10); // –≤—Ç–æ—Ä–æ ‚Äî —Å—Ç–∞–≤–∞ –Ω–∏–∑—Ö–æ–¥—è—â–æ
      }
    }
  });
</script>


{% endblock %}
